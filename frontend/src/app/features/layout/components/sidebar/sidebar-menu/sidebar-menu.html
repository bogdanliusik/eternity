@for (menu of menuService.pagesMenu; track menu) {
  <div>
    @if (menuService.showSideBar) {
      <div class="mx-1 flex items-center justify-between py-3">
        <small [class.hidden]="!menuService.showSideBar" class="text-muted-foreground/50 text-base font-semibold">
          {{ menu.group }}
        </small>
      </div>
    }
    <ul class="flex flex-col gap-1">
      @for (item of menu.items; track item) {
        <li class="relative">
          @if (item.children) {
            <div
              (click)="toggleMenu(item)"
              cdkOverlayOrigin
              #trigger="cdkOverlayOrigin"
              [ngClass]="{
                'hover:bg-primary/10': !menuService.showSideBar && item.active,
                'justify-center': !menuService.showSideBar
              }"
              class="group text-muted-foreground hover:bg-primary/10 relative flex h-[36px] grow cursor-pointer items-center gap-4 rounded-lg px-2"
              [attr.title]="!menuService.showSideBar ? item.label : null"
              [attr.aria-label]="!menuService.showSideBar ? item.label : null">
              <div class="group-hover:text-primary">
                <lucide-icon [img]="item.icon" class="h-5 w-5"></lucide-icon>
              </div>
              <span
                [class.hidden]="!menuService.showSideBar"
                class="group-hover:text-primary flex h-9 grow items-center justify-start truncate rounded-sm text-base font-semibold tracking-wide">
                {{ item.label }}
              </span>
              @if (menuService.showSideBar) {
                <button
                  class="text-color/50 right-0 flex cursor-pointer items-center justify-end p-0"
                  (click)="$event.stopPropagation(); item.expanded = !item.expanded"
                  type="button">
                  @if (!item.expanded) {
                    <lucide-icon [img]="plusIcon" class="h-4 w-4"></lucide-icon>
                  } @else {
                    <lucide-icon [img]="minusIcon" class="h-4 w-4"></lucide-icon>
                  }
                </button>
              }
            </div>
            <ng-template
              cdkConnectedOverlay
              [cdkConnectedOverlayOrigin]="trigger"
              [cdkConnectedOverlayOpen]="!menuService.showSideBar && !!item.expanded"
              [cdkConnectedOverlayHasBackdrop]="false"
              [cdkConnectedOverlayPositions]="overlayPositions"
              [cdkConnectedOverlayPush]="true"
              [cdkConnectedOverlayFlexibleDimensions]="true"
              [cdkConnectedOverlayViewportMargin]="8"
              [cdkConnectedOverlayScrollStrategy]="repositionsStrategy"
              (overlayOutsideClick)="onOverlayOutsideClick($event)">
              <div class="bg-card border-surface w-48 rounded-lg border shadow-lg">
                <div class="border-surface border-b px-3 py-2">
                  <span class="text-color text-base font-semibold">{{ item.label }}</span>
                </div>
                @for (child of item.children; track child) {
                  <a
                    routerLink="{{ child.route }}"
                    routerLinkActive="text-primary bg-primary/10"
                    class="text-muted-foreground hover:text-primary hover:bg-primary/5 flex items-center gap-3 px-3 py-2 text-base"
                    (click)="menuService.closeAllDropdowns()">
                    @if (child.icon) {
                      <lucide-icon [img]="child.icon" class="h-4 w-4"></lucide-icon>
                    }
                    <span>{{ child.label }}</span>
                  </a>
                }
              </div>
            </ng-template>
            @if (menuService.showSideBar) {
              <app-sidebar-submenu [submenu]="item"></app-sidebar-submenu>
            }
          } @else {
            <a
              routerLink="{{ item.route }}"
              routerLinkActive="text-primary"
              class="group text-muted-foreground hover:text-primary relative flex h-[36px] grow cursor-pointer items-center gap-4 rounded-lg px-2"
              [ngClass]="{
                'hover:bg-primary/10': !menuService.showSideBar && item.active,
                'bg-primary/5': item.active,
                'justify-center': !menuService.showSideBar
              }"
              [attr.title]="!menuService.showSideBar ? item.label : null"
              [attr.aria-label]="!menuService.showSideBar ? item.label : null">
              <div class="group-hover:text-primary relative">
                <lucide-icon [img]="item.icon" class="h-5 w-5"></lucide-icon>
                @if (!menuService.showSideBar && item.badgeCount && item.badgeCount > 0) {
                    <span
                      class="bg-primary absolute -top-1.5 -right-1.5 flex h-4 min-w-4 items-center justify-center rounded-full px-1 text-[10px] font-bold text-primary-contrast">
                    {{ item.badgeCount > 99 ? '99+' : item.badgeCount }}
                  </span>
                }
              </div>
              <span
                [class.hidden]="!menuService.showSideBar"
                class="group-hover:text-primary truncate text-base font-semibold tracking-wide">
                {{ item.label }}
              </span>
              @if (menuService.showSideBar && item.badgeCount && item.badgeCount > 0) {
                <span
                  class="bg-primary ml-auto flex h-5 min-w-5 items-center justify-center rounded-full px-1.5 text-xs font-bold text-primary-contrast">
                  {{ item.badgeCount > 99 ? '99+' : item.badgeCount }}
                </span>
              }
            </a>
          }
        </li>
      }
    </ul>
    @if (menu.separator) {
      <div class="py-3">
        <hr class="border-surface border-dashed" />
      </div>
    }
  </div>
}

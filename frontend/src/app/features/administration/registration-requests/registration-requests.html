<div class="space-y-6">
  <!-- Header -->
  <div class="flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between">
    <div>
      <h1 class="text-color text-2xl font-bold">Registration requests</h1>
      <p class="text-muted-foreground mt-1">Review and manage user registration requests</p>
    </div>
    <div class="flex items-center gap-3">
      @if (adminStore.pendingRequestsCount() > 0) {
        <p-tag [value]="adminStore.pendingRequestsCount() + ' pending'" severity="warn" />
      }
      <button
        pButton
        [disabled]="adminStore.isLoading()"
        (click)="onRefresh()"
        class="p-button-outlined"
        pTooltip="Refresh list"
        tooltipPosition="bottom">
        @if (adminStore.isLoading()) {
          <i class="pi pi-spin pi-spinner"></i>
        } @else {
          <lucide-icon [img]="refreshIcon" class="h-4 w-4"></lucide-icon>
        }
      </button>
    </div>
  </div>

  <!-- Tabs -->
  <div class="border-surface flex gap-1 border-b">
    @for (tab of tabs; track tab.id) {
      <button
        (click)="onTabChange(tab.id)"
        class="text-muted-foreground hover:text-primary relative flex items-center gap-2 px-4 py-3 text-sm font-medium transition-colors"
        [class.text-primary]="adminStore.activeTab() === tab.id"
        [class.text-color]="adminStore.activeTab() === tab.id">
        <lucide-icon [img]="tab.icon" class="h-4 w-4"></lucide-icon>
        <span>{{ tab.label }}</span>
        @if (getTabCount(tab.id) > 0) {
          <span
            class="flex h-5 min-w-5 items-center justify-center rounded-full px-1.5 text-xs font-semibold text-primary-contrast"
            [class.bg-primary]="tab.id === 'pending'"
            [class.text-white]="tab.id === 'pending'"
            [class.bg-green-500]="tab.id === 'approved'"
            [class.text-white]="tab.id === 'approved'"
            [class.bg-red-500]="tab.id === 'rejected'"
            [class.text-white]="tab.id === 'rejected'">
            {{ getTabCount(tab.id) }}
          </span>
        }
        @if (adminStore.activeTab() === tab.id) {
          <span class="bg-primary absolute right-0 bottom-0 left-0 h-0.5 rounded-t"></span>
        }
      </button>
    }
  </div>

  <!-- Content -->
  <div class="card overflow-hidden !p-0">
    @if (adminStore.isLoading() && adminStore.currentRequests().length === 0) {
      <div class="p-6">
        @for (i of [1, 2, 3]; track i) {
          <div class="mb-4 flex items-center gap-4">
            <p-skeleton shape="circle" size="40px" />
            <div class="flex-1">
              <p-skeleton width="60%" height="16px" styleClass="mb-2" />
              <p-skeleton width="40%" height="14px" />
            </div>
            <p-skeleton width="100px" height="32px" />
          </div>
        }
      </div>
    } @else if (adminStore.currentRequests().length === 0) {
      <div class="flex flex-col items-center justify-center py-16">
        <div class="bg-muted mb-4 rounded-full p-4">
          <lucide-icon [img]="inboxIcon" class="text-muted-foreground h-8 w-8"></lucide-icon>
        </div>
        <h3 class="text-color mb-1 text-lg font-semibold">{{ getEmptyStateMessage().title }}</h3>
        <p class="text-muted-foreground text-sm">{{ getEmptyStateMessage().description }}</p>
      </div>
    } @else {
      <p-table
        [value]="adminStore.currentRequests()"
        [tableStyle]="{ 'min-width': '60rem' }"
        styleClass="p-datatable-sm"
        [rowHover]="true">
        <ng-template #header>
          <tr>
            <th class="!font-semibold">User</th>
            <th class="!font-semibold">Username</th>
            <th class="!font-semibold">Email</th>
            <th class="!font-semibold">{{ adminStore.activeTab() === 'pending' ? 'Requested' : 'Processed' }}</th>
            <th
              class="!text-center !font-semibold"
              style="width: 180px"
              [hidden]="adminStore.activeTab() === 'approved'">
              Actions
            </th>
          </tr>
        </ng-template>
        <ng-template #body let-request>
          <tr>
            <td>
              <div class="flex items-center gap-3">
                <div
                  class="flex h-10 w-10 items-center justify-center rounded-full font-semibold"
                  [ngClass]="{
                    'bg-primary/10 text-primary': adminStore.activeTab() === 'pending',
                    'bg-green-500/10 text-green-600': adminStore.activeTab() === 'approved',
                    'bg-red-500/10 text-red-600': adminStore.activeTab() === 'rejected'
                  }">
                  {{ request.name.charAt(0).toUpperCase() }}
                </div>
                <span class="text-color font-medium">{{ request.name }}</span>
              </div>
            </td>
            <td>
              <span class="text-muted-foreground">&#64;{{ request.username }}</span>
            </td>
            <td>
              <span class="text-muted-foreground">{{ request.email }}</span>
            </td>
            <td>
              <span class="text-muted-foreground">
                {{
                  (adminStore.activeTab() === 'pending' ? request.requestedAt : request.processedAt)
                    | date: 'MMM d, y, h:mm a'
                }}
              </span>
            </td>
            <td [hidden]="adminStore.activeTab() === 'approved'">
              <div class="flex items-center justify-center gap-2">
                @if (adminStore.activeTab() === 'pending') {
                  <button
                    pButton
                    class="p-button-success p-button-sm"
                    [disabled]="isProcessing(request.id)"
                    (click)="onApprove(request)"
                    pTooltip="Approve request"
                    tooltipPosition="bottom">
                    @if (isProcessing(request.id)) {
                      <i class="pi pi-spin pi-spinner"></i>
                    } @else {
                      <lucide-icon [img]="userCheckIcon" class="h-4 w-4"></lucide-icon>
                    }
                    <span class="ml-1">Approve</span>
                  </button>
                  <button
                    pButton
                    class="p-button-danger p-button-outlined p-button-sm"
                    [disabled]="isProcessing(request.id)"
                    (click)="onReject(request)"
                    pTooltip="Reject request"
                    tooltipPosition="bottom">
                    <lucide-icon [img]="userXIcon" class="h-4 w-4"></lucide-icon>
                  </button>
                } @else if (adminStore.activeTab() === 'rejected') {
                  <button
                    pButton
                    class="p-button-success p-button-outlined p-button-sm"
                    [disabled]="isProcessing(request.id)"
                    (click)="onApprove(request)"
                    pTooltip="Approve this rejected request"
                    tooltipPosition="bottom">
                    @if (isProcessing(request.id)) {
                      <i class="pi pi-spin pi-spinner"></i>
                    } @else {
                      <lucide-icon [img]="userCheckIcon" class="h-4 w-4"></lucide-icon>
                    }
                    <span class="ml-1">Approve</span>
                  </button>
                }
              </div>
            </td>
          </tr>
        </ng-template>
      </p-table>
    }
  </div>
</div>
